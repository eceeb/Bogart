#!/usr/bin/env node
var app      = require('../app')
var http     = require('http')
var website  = require('../libs/website')
var database = require('../libs/database')


app.set('port', process.env.PORT)

var searchInterval = process.argv[2]
console.log('Starting search for ' + searchInterval + ' minutes interval...')

var searchProcess = function (foundSearches) {

	var urlToSearches = new Map()

	foundSearches.forEach( function (doc) {

		if (doc.found) return

		if (urlToSearches.get(doc.url))
			urlToSearches.get(doc.url).push(doc)
		else
			urlToSearches.set(doc.url, [doc])
	})

	website.load(urlToSearches)
}

database.select(searchInterval, searchProcess)
